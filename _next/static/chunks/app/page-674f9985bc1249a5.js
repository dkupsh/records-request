(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{787:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>Z});var n=l(5155),r=l(2115);l(5685),l(3386);var s=l(2809),a=l(902),i=l(7272),o=l(1846),c=l(8136),d=l(8964),u=l(6449),h=l(9051),p=l(5193);let m=[{label:"Full Name",value:"{{full_name}}",property:"full_name"},{label:"Name",value:"{{short_name}}",property:"short_name"},{label:"System",value:"{{system}}",property:"system"},{label:"State",value:"{{state}}",property:"state"},{label:"SJP Name",value:"{{sjp_name}}",property:"sjp_name"},{label:"Chancellor Name",value:"{{chancellor_name}}",property:"chancellor_name"},{label:"Police Chief",value:"{{police_chief}}",property:"police_chief"},{label:"Term",value:"{{term}}",property:"term"}],x=[{label:"State FOIA Law",value:"{{state_foia_law}}",property:"foia_law"}],f=[{label:"Requester Name",value:"{{requester_name}}",property:"name"},{label:"Requester Organization",value:"{{requester_organization}}",property:"organization"},{label:"Requester Email",value:"{{requester_email}}",property:"email"},{label:"Requester Phone",value:"{{requester_phone}}",property:"phone"},{label:"Requester Address",value:"{{requester_address}}",property:"address"}],g=[...m,...x],y=[{label:"Accepts Email",property:"accepts_email",options:["True","False"],default_option:"True"},{label:"Has Encampment",property:"had_encampment",options:["True","False"],default_option:"True"},{label:"Has SJP",property:"has_sjp",options:["True","False"],default_option:"True"},{label:"Has Police",property:"has_police",options:["True","False"],default_option:"True"},{label:"Has Undergraduate",property:"has_undergraduate",options:["True","False"],default_option:"True"},{label:"Is System",property:"is_system",options:["True","False"],default_option:"False"},{label:"Term Type",property:"term",options:["Quarter","Semester","Trimester","Other"],default_option:"Semester"}],j=e=>{let{visible_buttons:t=3,textValue:l,setTextValue:r,textareaRef:s}=e,i=e=>{let t=s.current;if(!t)return;let n=t.selectionStart,a=t.selectionEnd;r(l.slice(0,n)+e+l.slice(a)),setTimeout(()=>{t.focus(),t.setSelectionRange(n+e.length,n+e.length)},0)},o=g.slice(0,t),c=g.slice(t);return(0,n.jsxs)(u.A,{children:[o.map(e=>(0,n.jsx)(a.A,{variant:"outline-secondary",size:"sm",onClick:()=>i(e.value),children:e.label},e.value)),c.length>0&&(0,n.jsx)(h.A,{as:u.A,title:"More",variant:"outline-secondary",size:"sm",align:"end",id:"placeholder-dropdown",children:c.map(e=>(0,n.jsx)(p.A.Item,{onClick:()=>i(e.value),children:e.label},e.value))})]})},A=e=>{let{height:t="300px",textValue:l,setTextValue:s}=e,a=(0,r.useRef)(null);return(0,n.jsxs)("div",{children:[(0,n.jsx)(o.A,{className:"mb-2 justify-content-center",children:(0,n.jsx)(d.A.Label,{style:{display:"block",textAlign:"center"},children:"Request"})}),(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"column",height:t,gap:"0.5rem"},children:[(0,n.jsx)(o.A,{className:"mb-0 justify-content-center",style:{flexShrink:0},children:(0,n.jsx)(j,{visible_buttons:3,textValue:l,setTextValue:s,textareaRef:a})}),(0,n.jsx)(o.A,{style:{flexGrow:1},children:(0,n.jsx)(d.A.Control,{as:"textarea",ref:a,value:l,onChange:e=>s(e.target.value),style:{height:"100%",resize:"none"}})})]})]})};function b(e){let{isOpen:t}=e;return(0,n.jsx)("span",{style:{display:"inline-block",transform:t?"rotate(90deg)":"rotate(0deg)",transition:"transform 0.2s ease",color:"#333",fontSize:"16px",lineHeight:1,userSelect:"none"},children:"▶"})}let v=e=>{let{name:t,checked:l,onChange:r}=e;return(0,n.jsxs)("div",{onClick:()=>{r()},role:"checkbox","aria-checked":l,tabIndex:0,style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0.75rem 1rem",border:"2px solid #ccc",backgroundColor:"#6c757d",color:"white",userSelect:"none",cursor:"pointer",width:"100%",fontWeight:700,opacity:.9,flexDirection:"row"},children:[(0,n.jsx)(d.A.Check,{type:"checkbox",checked:l,readOnly:!0,style:{pointerEvents:"none"}}),(0,n.jsx)("div",{style:{flex:1,marginLeft:"1rem",textAlign:"left"},children:t})]})},C=e=>{let{name:t,checked:l,onChange:r,caretOpen:s=!1,onCaretClick:a}=e;return(0,n.jsxs)("div",{onClick:()=>{r()},role:"checkbox","aria-checked":l,tabIndex:0,style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0.75rem 1rem",border:"2px solid #ccc",backgroundColor:"#6c757d",color:"white",userSelect:"none",cursor:"pointer",width:"100%",fontWeight:700,opacity:.9,flexDirection:"row"},children:[(0,n.jsx)(d.A.Check,{type:"checkbox",checked:l,readOnly:!0,style:{pointerEvents:"none"}}),(0,n.jsx)("div",{style:{flex:1,marginLeft:"1rem",textAlign:"left"},children:t}),(0,n.jsx)("button",{onClick:e=>{e.stopPropagation(),a&&a(e)},"aria-label":s?"Collapse":"Expand",style:{backgroundColor:"white",border:"1px solid #ccc",borderRadius:"2px",width:24,height:24,cursor:"pointer",display:"flex",justifyContent:"center",alignItems:"center",padding:0,flexShrink:0,marginLeft:"8px"},type:"button",children:(0,n.jsx)(b,{isOpen:s})})]})},_=e=>{let{agency:t,checked:l,onChange:r}=e;return(0,n.jsxs)("div",{onClick:()=>{r()},role:"checkbox","aria-checked":l,tabIndex:0,style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0.75rem 1rem",border:"2px solid #ccc",backgroundColor:l?"#28a745":"#dc3545",color:"white",userSelect:"none",cursor:"pointer",width:"100%",fontWeight:500,opacity:1,flexDirection:"row"},children:[(0,n.jsx)(d.A.Check,{type:"checkbox",checked:l,readOnly:!0,style:{pointerEvents:"none"}}),(0,n.jsx)("div",{style:{flex:1,marginLeft:"1rem",textAlign:"left"},children:t.full_name})]})};function S(e,t){let l=[];for(let t of e)t&&l.push({parent:null,children:[],name:t.full_name,agency:t});for(let e of t){let t={},r=[];for(let s of l){var n;let l=null==(n=s.agency)?void 0:n[e];""===l||null==l?r.push(s):(l in t?t[l].children.push(s):t[l]={parent:null,children:[s],name:l,agency:s.agency},s.parent=t[l])}l=[...Object.values(t),...r]}let r={parent:null,children:l,name:"Select All"};for(let e of l)e.parent=r;return r}let k=e=>{let{group:t,parentCollapsed:l,isSelected:s,toggleSelection:a}=e,i=0===t.children.length,o=null===t.parent,[c,d]=(0,r.useState)(!0);return((0,r.useEffect)(()=>{l&&d(!0)},[l]),i&&t.agency)?(0,n.jsx)(_,{agency:t.agency,checked:s(t),onChange:()=>{a(t)}}):(console.log(t.children),o)?(0,n.jsxs)("div",{children:[(0,n.jsx)(v,{name:t.name,checked:s(t),onChange:()=>{a(t)}},t.name),t.children.map(e=>(0,n.jsx)(k,{group:e,parentCollapsed:c,isSelected:s,toggleSelection:a},e.name))]}):(0,n.jsxs)("div",{children:[(0,n.jsx)(C,{name:t.name,checked:s(t),onChange:()=>{a(t)},caretOpen:!c,onCaretClick:()=>d(!c)}),!c&&(0,n.jsx)("div",{style:{paddingLeft:"1rem"},children:t.children.map(e=>(0,n.jsx)(k,{group:e,parentCollapsed:c,isSelected:s,toggleSelection:a},e.name))})]})},w=e=>{var t;let{filter:l,checked:r,value:s,setValue:a,onChange:i}=e;return(0,n.jsxs)(o.A,{className:"align-items-center mb-2",children:[(0,n.jsx)(c.A,{xs:"auto",children:(0,n.jsx)(d.A.Check,{type:"checkbox",id:l.property,label:l.label,checked:r,onChange:()=>i(l)})}),(null==(t=l.options)?void 0:t.length)>0&&(0,n.jsx)(c.A,{children:(0,n.jsx)(d.A.Select,{size:"sm",value:null!=s?s:"",onChange:e=>a(l,e.target.value),children:l.options.map(e=>(0,n.jsx)("option",{value:e,children:e},e))})})]})},E=e=>{let{filters:t,selectedFilters:l,setSelectedFilters:r}=e,s=e=>t.findIndex(t=>t.property===e.property),a=e=>l[s(e)],i=(e,t)=>{let l=s(e);r(e=>{let n=[...e];return n[l]={...n[l],selected_option:t},n})},o=e=>{let t=s(e);r(e=>{let l=[...e];return l[t]={...l[t],is_selected:!l[t].is_selected},l})};return(0,n.jsxs)(p.A,{align:"end",children:[(0,n.jsx)(p.A.Toggle,{variant:"outline-secondary",title:"Filter",children:(0,n.jsx)("i",{className:"bi bi-funnel"})}),(0,n.jsx)(p.A.Menu,{style:{padding:"0.5rem 1rem",minWidth:"250px"},children:t.map(e=>(0,n.jsx)(w,{filter:e,checked:(e=>{let t=a(e);return!!t&&t.is_selected})(e),value:(e=>{let t=a(e);return t&&(t.selected_option||e.default_option)||""})(e),setValue:i,onChange:o},e.property))})]})};function N(e){let t=[];for(let l of e)t.push({parent:null,children:[],name:l.full_name,agency:l});let l={parent:null,children:t,name:"All Agencies"};for(let e of t)e.parent=l;return l}let T=e=>{let{group:t,searchText:l,isSelected:r,toggleSelection:s}=e;if(0===t.children.length&&t.agency)return(0,n.jsx)(_,{agency:t.agency,checked:r(t),onChange:()=>{s(t)}});let a=t.children.filter(e=>e.name.toLowerCase().includes(l.toLowerCase()));return(0,n.jsx)("div",{children:a.map(e=>(0,n.jsx)(T,{group:e,searchText:l,isSelected:r,toggleSelection:s},e.name))})},I=e=>{let{agencies:t,height:l="300px",selectedAgencies:a,setSelectedAgencies:i}=e,[o,c]=(0,r.useState)(""),[u,h]=(0,r.useState)(S(t,["system","state"])),[p,m]=(0,r.useState)(N(t)),[x,f]=(0,r.useState)([]),[g,j]=(0,r.useState)([]),[A,b]=(0,r.useState)([]);(0,r.useEffect)(()=>{j(y)},[]),(0,r.useEffect)(()=>{b(g.map(e=>({is_selected:!1,selected_option:e.default_option})))},[g]),(0,r.useEffect)(()=>{if(g.length!==A.length)return;let e=t;for(let t=0;t<g.length;t++){let l=g[t],n=A[t];if(n.is_selected&&n.selected_option){let t=l.property,r=e[0],s=r&&"boolean"==typeof r[t]?"true"===n.selected_option.toLowerCase():n.selected_option;e=e.filter(e=>e[t]===s)}}f(e)},[t,A,g]),(0,r.useEffect)(()=>{h(S(x,["system","state"])),m(N(x))},[x]);let v=e=>{if(0!==e.children.length)return e.children.every(e=>v(e));{var t;let l=null==(t=e.agency)?void 0:t.full_name;return!!e.agency&&a.some(e=>e.full_name===l)}},C=(e,t)=>{if(0===e.children.length)e.agency&&(t?i(t=>[...t,e.agency]):i(t=>t.filter(t=>{var l;return t.full_name!==(null==(l=e.agency)?void 0:l.full_name)})));else for(let l of e.children)C(l,t)},_=e=>{if(0===e.children.length)v(e)?i(t=>t.filter(t=>{var l;return t.full_name!==(null==(l=e.agency)?void 0:l.full_name)})):e.agency&&i(t=>[...t,e.agency]);else for(let t of e.children)C(t,!v(e))};return(0,n.jsx)(s.A,{style:{maxWidth:"400px"},children:(0,n.jsxs)("div",{style:{width:"100%",height:l,overflowY:"auto",border:"1px solid #ced4da",borderRadius:"0.25rem"},children:[(0,n.jsxs)("div",{style:{padding:"0.75rem",backgroundColor:"#f8f9fa"},children:[(0,n.jsx)(d.A.Control,{type:"text",placeholder:"Search agencies...",value:o,onChange:e=>c(e.target.value)}),(0,n.jsxs)("div",{className:"d-flex justify-content-between align-items-center mt-2",style:{fontSize:"0.9rem",color:"#555"},children:[(0,n.jsxs)("div",{children:[a.length," selected"]}),(0,n.jsx)(E,{filters:g,selectedFilters:A,setSelectedFilters:b})]})]}),""===o&&(0,n.jsx)(k,{parentCollapsed:!0,group:u,isSelected:v,toggleSelection:_},u.name),""!==o&&(0,n.jsx)(T,{group:p,searchText:o,isSelected:v,toggleSelection:_})]})})},L=e=>{let{agencies:t,height:l="300px",selectedAgencies:r,setSelectedAgencies:s}=e;return(0,n.jsxs)("div",{children:[(0,n.jsx)(o.A,{children:(0,n.jsx)(d.A.Label,{style:{display:"block",textAlign:"center"},children:"Agency"})}),(0,n.jsx)(o.A,{children:(0,n.jsx)(I,{agencies:t,height:l,selectedAgencies:r,setSelectedAgencies:s})})]})},R=e=>{let{agencies:t,selectedAgencies:l,setSelectedAgencies:r,requestText:d,setRequestText:u,errorModal:h,setErrorModal:p,handleSubmit:m}=e,x="600px";return(0,n.jsxs)(s.A,{fluid:!0,children:[(0,n.jsxs)(o.A,{children:[(0,n.jsx)(c.A,{sm:4,children:(0,n.jsx)(L,{agencies:t,height:x,selectedAgencies:l,setSelectedAgencies:r})}),(0,n.jsx)(c.A,{sm:8,children:(0,n.jsx)(A,{height:x,textValue:d,setTextValue:u})})]}),(0,n.jsx)(o.A,{children:(0,n.jsx)(a.A,{variant:"primary",type:"button",onClick:m,children:"Submit"})}),(0,n.jsxs)(i.A,{show:h,centered:!0,children:[(0,n.jsx)(i.A.Header,{closeButton:!0,children:(0,n.jsx)(i.A.Title,{children:"Error"})}),(0,n.jsx)(i.A.Body,{children:"Request Requires at least one agency."}),(0,n.jsx)(i.A.Footer,{children:(0,n.jsx)(a.A,{variant:"primary",onClick:()=>p(!1),children:"Ok"})})]})]})},q=e=>{var t,l;let{selectedAgencies:r,currentAgencyIndex:i,incrementAgencyIndex:u,decrementAgencyIndex:h}=e;return(0,n.jsx)(s.A,{children:(0,n.jsxs)(o.A,{className:"align-items-center",children:[(0,n.jsx)(c.A,{xs:"auto",children:(0,n.jsx)(a.A,{variant:"outline-secondary",onClick:h,children:"← Prev"})}),(0,n.jsx)(c.A,{className:"text-center",children:(0,n.jsx)(d.A.Label,{style:{fontWeight:"bold",margin:0},children:null!=(l=null==(t=r[i])?void 0:t.full_name)?l:"No Agency Selected"})}),(0,n.jsx)(c.A,{xs:"auto",className:"text-end",children:(0,n.jsx)(a.A,{variant:"outline-secondary",onClick:u,children:"Next →"})})]})})};var F=l(2311);let z=e=>{let{label:t,text:l,height:s=30,editable:a=!1,setText:i}=e,[u,h]=(0,r.useState)(!1);return(0,n.jsxs)(o.A,{style:{backgroundColor:"#f8f9fa",borderRadius:"0.5rem",padding:"0rem"},children:[(0,n.jsx)(c.A,{sm:1,children:(0,n.jsxs)(d.A.Label,{style:{fontWeight:"bold",display:"block",textAlign:"left",lineHeight:"0px",padding:"0rem",transform:"translateY(14px)"},children:[t,":"]})}),(0,n.jsx)(c.A,{sm:11,children:(0,n.jsxs)("div",{style:{position:"relative"},children:[(0,n.jsx)(d.A.Control,{as:"textarea",value:l,readOnly:!a,onChange:e=>{a&&i&&i(e.target.value)},rows:s,style:{resize:"none",paddingRight:"6rem"}}),(0,n.jsxs)("div",{onClick:()=>{navigator.clipboard.writeText(l),h(!0),setTimeout(()=>h(!1),1500)},style:{position:"absolute",top:"0.5rem",right:"1rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.25rem",backgroundColor:"rgba(255,255,255,0.9)",padding:"0.25rem 0.5rem",borderRadius:"0.25rem",height:"28px",zIndex:2},children:[(0,n.jsx)(F.A,{size:16}),u&&(0,n.jsx)("span",{style:{fontSize:"0.75rem",color:"green",whiteSpace:"nowrap"},children:"Copied!"})]})]})})]})},O=e=>{let{emailBody:t,setEmailBody:l,handleSend:r}=e;return(0,n.jsxs)(s.A,{fluid:!0,children:[(0,n.jsx)(o.A,{children:(0,n.jsx)(z,{label:"Request",text:t,height:22,editable:!0,setText:l})}),(0,n.jsx)(o.A,{children:(0,n.jsx)(a.A,{variant:"primary",type:"button",onClick:r,children:"Open"})})]})},B=e=>{let{emailToLine:t,emailSubjectLine:l,emailBody:r,setEmailBody:i,handleSend:c}=e;return(0,n.jsxs)(s.A,{fluid:!0,children:[(0,n.jsx)(o.A,{children:(0,n.jsx)(z,{label:"To",text:t,height:1})}),(0,n.jsx)(o.A,{children:(0,n.jsx)(z,{label:"Subject",text:l,height:1})}),(0,n.jsx)(o.A,{children:(0,n.jsx)(z,{label:"Body",text:r,height:20,editable:!0,setText:i})}),(0,n.jsx)(o.A,{children:(0,n.jsx)(a.A,{variant:"primary",type:"button",onClick:c,children:"Send"})})]})},H=e=>{let{selectedAgencies:t,currentAgencyIndex:l,setCurrentAgencyIndex:d,emailToLine:u,emailSubjectLine:h,emailBody:p,setEmailBody:m,sentAgencies:x,sendRequest:f,handleEdit:g,isEmail:y}=e,[j,A]=(0,r.useState)(!1),b=()=>{x.includes(l)?A(!0):f()},v=()=>{d(e=>(e+1)%t.length)},C=()=>{d(e=>(e-1+t.length)%t.length)};(0,r.useEffect)(()=>{let e=e=>{"Enter"===e.key&&(e.preventDefault(),b()),"ArrowRight"===e.key&&(e.preventDefault(),v()),"ArrowLeft"===e.key&&(e.preventDefault(),C())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)});let _=()=>{A(!1)};return(0,n.jsxs)(s.A,{fluid:!0,children:[(0,n.jsxs)(o.A,{children:[(0,n.jsx)(c.A,{sm:8,children:(0,n.jsx)(q,{selectedAgencies:t,currentAgencyIndex:l,incrementAgencyIndex:v,decrementAgencyIndex:C})}),(0,n.jsx)(c.A,{sm:4,children:(0,n.jsx)(a.A,{variant:"primary",type:"button",onClick:g,children:"Edit"})})]}),y&&(0,n.jsx)(B,{emailToLine:u,emailSubjectLine:h,emailBody:p,setEmailBody:m,handleSend:b}),!y&&(0,n.jsx)(O,{emailBody:p,setEmailBody:m,handleSend:b}),(0,n.jsxs)(i.A,{show:j,onHide:_,centered:!0,children:[(0,n.jsx)(i.A.Header,{closeButton:!0,children:(0,n.jsx)(i.A.Title,{children:"Confirm Re-send"})}),(0,n.jsx)(i.A.Body,{children:"Already sent request. Do you want to send again?"}),(0,n.jsxs)(i.A.Footer,{children:[(0,n.jsx)(a.A,{variant:"secondary",onClick:_,children:"No"}),(0,n.jsx)(a.A,{variant:"primary",onClick:()=>{A(!1),f()},children:"Yes"})]})]})]})};var P=l(7383),D=l(408),W=l.n(D);let G="/records-request";async function U(){let e=await fetch("".concat(G,"/state-info.csv")),t=await e.text();return W().parse(t,{header:!0,skipEmptyLines:!0,transformHeader:e=>e.trim(),transform:e=>e.trim()}).data.sort((e,t)=>e.state.localeCompare(t.state))}async function V(){let e=await fetch("".concat(G,"/records-agencies.csv")),t=await e.text(),l=W().parse(t,{header:!0,skipEmptyLines:!0,transformHeader:e=>e.trim(),transform:e=>{let t=e.trim().toLowerCase();return"true"===t||"false"!==t&&e.trim()}}).data.sort((e,t)=>t.accepts_email!==e.accepts_email?Number(t.accepts_email)-Number(e.accepts_email):e.state!==t.state?e.state.localeCompare(t.state):e.system!==t.system?e.system.localeCompare(t.system):e.full_name.localeCompare(t.full_name));return console.log("Sorted agencies:",l),l}async function J(e,t,l,n){let r=M(e,t,l,n);return await Y(n.template_file,r,t)}function M(e,t,l,n){if(!l||!n)return e;let r=e;for(let{value:e,property:t}of m){let n=l[t],s=null!=n?String(n):"";r=r.replace(RegExp(e,"g"),s)}for(let{value:e,property:t}of x){let l=n[t],s=null!=l?String(l):"";r=r.replace(RegExp(e,"g"),s)}for(let{value:e,property:l}of f){let n=t[l],s=null!=n?String(n):"";r=r.replace(RegExp(e,"g"),s)}return r}async function Y(e,t,l){let n=await fetch("".concat("/records-request","/templates/").concat(e));if(!n.ok)throw Error("Failed to fetch template: ".concat(e));let r=await n.text();return(r=r.replace(/{{body}}/g,t)).replace(/{{sign_off}}/g,function(e){let{name:t,email:l,phone:n,address:r}=e;return[t,l,n,r].every(e=>!e.trim())?"":"\nBest,\n".concat(t,"\n").concat(l,"\n").concat(n,"\n").concat(r,"\n  ").trim()}(l))}var $=l(4016);let Q=e=>{let{user_info:t,setUserInfo:l}=e,[s,a]=(0,r.useState)({email:!1,phone:!1});return(0,n.jsxs)($.A,{className:"mb-4 shadow-sm",children:[(0,n.jsx)($.A.Header,{as:"h5",children:"Requester Info"}),(0,n.jsx)($.A.Body,{children:(0,n.jsxs)(d.A,{children:[(0,n.jsxs)(d.A.Group,{className:"mb-3",controlId:"userName",children:[(0,n.jsx)(d.A.Label,{children:"Name"}),(0,n.jsx)(d.A.Control,{type:"text",value:t.name,onChange:e=>l({...t,name:e.target.value})})]}),(0,n.jsxs)(d.A.Group,{className:"mb-3",controlId:"userOrg",children:[(0,n.jsx)(d.A.Label,{children:"Organization"}),(0,n.jsx)(d.A.Control,{type:"text",value:t.organization,onChange:e=>l({...t,organization:e.target.value})})]}),(0,n.jsxs)(d.A.Group,{className:"mb-3",controlId:"userEmail",children:[(0,n.jsx)(d.A.Label,{children:"Email"}),(0,n.jsx)(d.A.Control,{type:"email",isInvalid:s.email&&!(e=>""===e||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))(t.email),value:t.email,onChange:e=>l({...t,email:e.target.value}),onBlur:()=>a(e=>({...e,email:!0}))}),(0,n.jsx)(d.A.Control.Feedback,{type:"invalid",children:"Please enter a valid email address."})]}),(0,n.jsxs)(d.A.Group,{className:"mb-3",controlId:"userPhone",children:[(0,n.jsx)(d.A.Label,{children:"Phone"}),(0,n.jsx)(d.A.Control,{type:"tel",isInvalid:s.phone&&!(e=>""===e||/^\+?[0-9\s\-()]{7,}$/.test(e))(t.phone),value:t.phone,onChange:e=>l({...t,phone:e.target.value}),onBlur:()=>a(e=>({...e,phone:!0}))}),(0,n.jsx)(d.A.Control.Feedback,{type:"invalid",children:"Please enter a valid phone number."})]}),(0,n.jsxs)(d.A.Group,{className:"mb-3",controlId:"userAddress",children:[(0,n.jsx)(d.A.Label,{children:"Address"}),(0,n.jsx)(d.A.Control,{type:"text",value:t.address,onChange:e=>l({...t,address:e.target.value})})]})]})})]})},K=e=>{let{showSettings:t,setShowSettings:l,user_info:r,setUserInfo:s}=e;return(0,n.jsxs)(i.A,{show:t,onHide:()=>l(!1),centered:!0,children:[(0,n.jsx)(i.A.Header,{closeButton:!0,children:(0,n.jsx)(i.A.Title,{children:"Settings"})}),(0,n.jsx)(i.A.Body,{children:(0,n.jsx)(Q,{user_info:r,setUserInfo:s})}),(0,n.jsx)(i.A.Footer,{children:(0,n.jsx)(a.A,{variant:"secondary",onClick:()=>l(!1),children:"Close"})})]})},X="user_info";function Z(){let[e,t]=(0,r.useState)({name:"",organization:"",email:"",phone:"",address:""}),[l,s]=(0,r.useState)([]),[i,o]=(0,r.useState)([]),[c,d]=(0,r.useState)([]),[u,h]=(0,r.useState)([]),[p,m]=(0,r.useState)(0),[x,f]=(0,r.useState)(""),[g,y]=(0,r.useState)(!1),[j,A]=(0,r.useState)(!1),[b,v]=(0,r.useState)(!1),[C,_]=(0,r.useState)(""),[S,k]=(0,r.useState)(""),[w,E]=(0,r.useState)(""),[N,T]=(0,r.useState)(!0);(0,r.useEffect)(()=>{let e=P.A.get(X);if(e)try{let l=JSON.parse(e);t(l)}catch(e){console.error("Failed to parse userInfo cookie",e)}},[]),(0,r.useEffect)(()=>{P.A.set(X,JSON.stringify(e),{expires:365})},[e]),(0,r.useEffect)(()=>{U().then(d),V().then(s)},[]),(0,r.useEffect)(()=>{0===i.length||p>=i.length||T(i[p].accepts_email)},[p,i]),(0,r.useEffect)(()=>{if(0===i.length||p>=i.length)return;let t=i[p],l=function(e,t){let l=t.find(t=>t.state.toLowerCase()===e.state.toLowerCase());if(l)return l;throw Error("State not found for agency: ".concat(e.full_name,' "').concat(e.state,'"'))}(t,c);_(t.accepts_email?t.email:""),k(M("{{state_foia_law}} Request",e,t,l)),J(x,e,t,l).then(e=>{E(e)})},[p,i,e,c,x]),(0,r.useEffect)(()=>{o(e=>[...e].sort((e,t)=>e.accepts_email!==t.accepts_email?e.accepts_email?-1:1:e.system!==t.system?e.system.localeCompare(t.system):e.full_name.localeCompare(t.full_name)))},[i.length]);let I=(0,r.useRef)(p);return(0,r.useEffect)(()=>{if(u.length===i.length)return;let e=i.length,t=I.current%e;for(let l=0;l<e;l++){let n=(t+l)%e;if(!u.includes(n)){m(n),I.current=n+1;break}}},[u,i]),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"position-relative",children:(0,n.jsx)(a.A,{variant:"secondary",size:"sm",className:"position-absolute top-0 end-0 d-flex align-items-center justify-content-center",onClick:()=>v(!0),children:(0,n.jsx)("i",{className:"bi bi-gear-fill"})})}),(0,n.jsx)(K,{showSettings:b,setShowSettings:v,user_info:e,setUserInfo:t}),!g&&(0,n.jsx)(R,{agencies:l,selectedAgencies:i,setSelectedAgencies:o,requestText:x,setRequestText:f,errorModal:j,setErrorModal:A,handleSubmit:e=>{if(e.preventDefault(),0===i.length)return void A(!0);y(!0),h([])}}),g&&(0,n.jsx)(H,{selectedAgencies:i,currentAgencyIndex:p,setCurrentAgencyIndex:m,emailToLine:C,emailSubjectLine:S,emailBody:w,setEmailBody:E,sentAgencies:u,sendRequest:()=>{if(N){let e=function(e,t,l){let n=encodeURIComponent(e.email),r=encodeURIComponent(t),s=encodeURIComponent(l);return"mailto:".concat(n,"?subject=").concat(r,"&body=").concat(s)}(i[p],S,w);window.location.href=e}else{let e=i[p];(null==e?void 0:e.website)?window.open(e.website,"_blank"):alert("No website available for this agency.")}h(e=>e.includes(p)?e:[...e,p])},handleEdit:e=>{e.preventDefault(),y(!1),h([]),m(0)},isEmail:N})]})}},5240:(e,t,l)=>{Promise.resolve().then(l.bind(l,787))}},e=>{e.O(0,[740,675,449,441,964,358],()=>e(e.s=5240)),_N_E=e.O()}]);